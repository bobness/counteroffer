<div class="col-lg-12" style="margin: 0 auto;text-align:center;">
  <div style="display:block;margin:auto;">
    <ul class="nav nav-pills" style="margin-bottom:10px;display:inline-block;">
      <li ng-class="{active: !path}">
        <a ng-click="setPath('')" style="cursor:pointer;">Active</a>
      </li>
      <li ng-class="{active: path === 'archived'}">
        <a ng-click="setPath('archived')" style="cursor:pointer;">Archived</a>
      </li>
    </ul>
  </div>
  <div class="col-sm-8" id="accordion" style="margin-top:15px;">
    <div ng-show="!jobs || jobs.length === 0">
      There are no jobs yet. Wait until you get an offer from a recruiter. 
    </div>
    <div ng-show="jobs.length > 0">
      Sort by: <ul class="tag-list">
        <li class="tag-item" ng-click="sortByFactKey('')" style="cursor:pointer;color:black;">Latest Message</li>
      	<li ng-repeat="(key, class) in factClasses track by $index" class="tag-item {{ class }}" ng-click="sortByFactKey(key)" style="cursor:pointer;">
      	  {{ key }}
        </li>
      </ul>
    </div>
    <div style="text-align:center;margin:10px;" ng-show="!path">
      <div>
        <form><input type="text" ng-model="newJob.email" placeholder="Recruiter email">
        <button class="btn btn-sm btn-default" type="submit" ng-click="addJob(newJob)">
          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
          Add Job
        </button></form>
      </div>
    </div>
    <div ng-repeat="job in jobs | filter: getJobFilter(path === 'archived') | orderBy: sortJobs() : true track by $index" ng-show="!busy" class="panel panel-default">
      <div class="panel-heading" id="heading{{job.id}}" data-toggle="collapse" data-target="#collapse{{job.id}}" aria-expanded="false" aria-controls="collapse{{job.id}}" style="cursor:pointer;" ng-click="toggleJob(job)">
        <p>Job #{{ job.id }} from {{ job.email }} 
          <a href="#" editable-text="job.company" onaftersave="updateJob(job)">({{ job.company || 'Company name' }})</a>
        </p>
        <p>Latest message: {{ displayDate(job) }}</p>
        <ul class="tag-list">
        	<li class="tag-item" ng-repeat="fact in job.facts track by $index" ng-class="getFactClass(fact.key)">{{ fact.value }}</li>
        </ul>
      </div>
  
      <div id="collapse{{job.id}}" class="collapse" aria-labelledby="heading{{job.id}}" data-parent="#accordion">
        <div ng-show="gettingMessages">
          <img src="loading.gif" />
        </div>
        <div class="panel-body" ng-hide="gettingMessages">
          <ul class="list-unstyled" style="clear:both;">
            <li ng-repeat="message in job.messages | orderBy: 'datetime'" ng-style="getMessageStyle(job, message.sender)">
              <span class="message" ng-bind-html="getHTML(message.value || '(No reply)')"></span>
            </li>
          </ul>
          <div style="height:100px;margin:10px;" ng-show="!path">
            <form style="height:100%">
              <textarea ng-model="newMessage.value" style="width:calc(100% - 80px);height:100%;"></textarea>
              <div style="float:right;width:80px;">
                <button class="btn btn-sm btn-default" ng-click="sendMessage(newMessage, job)" style="margin:10px;">
                  <span class="glyphicon glyphicon-upload" aria-hidden="true"></span>
                  Reply
                </button>
                <button class="btn btn-sm btn-default panel" ng-click="archiveJob(job, true, newMessage)" style="margin:10px;">
                  <span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span>
                  Archive
                </button>
              </div>
            </form>
          </div>
          <div style="clear:both;" ng-show="jobs.length > 1">
            <button class="btn btn-sm btn-default panel" ng-click="archiveJob(job, false)">
              <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
              Unarchive
            </button>
            <button class="btn btn-sm btn-default panel" ng-click="deleteJob(job)">
              <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
              Delete Job
            </button>
          </div>
        </div>
      </div>
      
    </div>
    <div ng-show="busy">
      <img src="loading.gif" />
    </div>
  </div>
  
  <div class="col-sm-4">
    <div class="panel panel-default" id="scratchPad" ng-show="jobs.length > 0">
      <div class="panel-heading">Scratch Pad</div>
      <div class="panel-body">
        <div ng-show="gettingFacts">
          <img src="loading.gif" />
        </div>
        <table class="table" ng-show="selectedJob.facts.length > 0" style="text-align:left;">
          <thead>
            <tr>
              <th scope="col">Fact Name</th>
              <th scope="col">Fact Value</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="fact in selectedJob.facts | orderBy: 'id'" ng-hide="gettingFacts">
              <td><a href="#" editable-text="fact.key" onaftersave="updateFact(selectedJob, fact)">
                <strong>{{ fact.key }}</strong>
              </a></td>
              <td><a href="#" editable-text="fact.value" onaftersave="updateFact(selectedJob, fact)">
                {{ fact.value }}
              </a></td>
              <td>
                <button class="btn btn-sm btn-default panel" ng-click="deleteFact(selectedJob, fact)">
                  <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <div ng-show="!selectedJob.facts || selectedJob.facts.length === 0">
          <p>Select text from the job messages to add facts to your scratch pad</p>
        </div>
        <div style="margin-top:15px;" ng-show="selectedJob">
          <button class="btn btn-sm btn-default" ng-click="addFactFromSelection(selectedJob)">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
            Add Selected Text
          </button>
        </div>
        <div style="margin-top:15px;" ng-show="selectedJob">
          <button class="btn btn-sm btn-default" ng-click="addFact(selectedJob)">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
            Manually Add New Fact
          </button>
        </div>
      </div>
    </div>
  </div>
</div>